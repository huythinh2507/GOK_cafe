@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
@{
    var products = new List<Umbraco.Cms.Core.Models.PublishedContent.IPublishedContent>();

    // Get ProductCoffee from ProductList children
    if (Model != null)
    {
        var productCoffeeNode = Model.Children.FirstOrDefault(x => x.ContentType.Alias == "product");
        if (productCoffeeNode != null)
        {
            // Get all ProductCoffeeItem children from ProductCoffee
            var productItems = productCoffeeNode.Children.Where(x => x.ContentType.Alias == "productCoffeeItem").ToList();

            // Duplicate products to show 12 items (repeat 4 times)
            for (int i = 0; i < 4; i++)
            {
                products.AddRange(productItems);
            }
        }
    }

    // Filter configuration data
    var filterConfig = new[]
    {
        new
        {
            Id = "category",
            Title = "Product Category",
            Options = new[] { "All categories", "Coffees", "Bubble Tea", "Sweet Doughs" },
            CheckedStates = new[] { true, true, true, true },
            HasBottomBorder = true
        },
        new
        {
            Id = "flavour",
            Title = "Flavour Profile",
            Options = new[] { "Balanced", "Bold and Bitter", "Chocolatey and Nutty", "Delicate and Complex", "Experimental", "Fruity and Punchy" },
            CheckedStates = (bool[])null,
            HasBottomBorder = true
        },
        new
        {
            Id = "availability",
            Title = "Availability",
            Options = new[] { "Instock (30)", "Out of stock (3)" },
            CheckedStates = (bool[])null,
            HasBottomBorder = true
        },
        new
        {
            Id = "equipment",
            Title = "Equipment",
            Options = new[] { "Aeropress", "Channi", "Cold Brew", "Espresso", "French Press", "Inverted Aeropress", "Moka Pot", "Pourover", "South Indian Filter" },
            CheckedStates = (bool[])null,
            HasBottomBorder = false
        }
    };

    // Helper function to render checkbox
    void RenderCheckbox(string label, bool isChecked = false)
    {
        <label class="flex items-center cursor-pointer hover:bg-primary/10 p-2 -m-2 rounded transition-colors">
            <input type="checkbox" class="w-5 h-5 accent-primary border-gray-300 rounded focus:ring-primary" @(isChecked ? "checked" : "")>
            <span class="ml-3 text-sm text-gray-700">@label</span>
        </label>
    }

    // Helper function to render filter section
    void RenderFilterSection(string id, string title, string[] options, bool hasBottomBorder = true, bool[] checkedStates = null)
    {
        <div class="@(hasBottomBorder ? "border-b border-gray-200 " : "")pb-4">
            <button class="flex items-center justify-between w-full text-left font-semibold text-gray-900 mb-4" onclick="toggleFilter('@id')">
                <span>@title</span>
                <i class="fas fa-chevron-up" id="@id-icon"></i>
            </button>
            <div id="@id-filter" class="space-y-3">
                @for (int i = 0; i < options.Length; i++)
                {
                    bool isChecked = checkedStates != null && i < checkedStates.Length && checkedStates[i];
                    RenderCheckbox(options[i], isChecked);
                }
            </div>
        </div>
    }
}

<!-- Products Grid Section -->
<section class="py-12 bg-white">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Page Title -->
        <h1 class="text-3xl font-semibold text-gray-900 mb-8">PRODUCTS LIST</h1>

        <div class="flex flex-col justify-between lg:flex-row gap-8">
            <!-- Filters Sidebar -->
            <aside class="w-full lg:w-48 flex-shrink-0">
                <div class="space-y-6">
                    @foreach (var filter in filterConfig)
                    {
                        RenderFilterSection(
                            filter.Id,
                            filter.Title,
                            filter.Options,
                            filter.HasBottomBorder,
                            filter.CheckedStates
                        );
                    }
                </div>
            </aside>

            <!-- Products Grid -->
            <div class="lg:min-w-80">
                @if (products.Any())
                {
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-8 mb-12">
                        @foreach (var product in products)
                        {
                            @await Html.PartialAsync("~/Views/Partials/Products/ProductCard.cshtml", product)
                        }
                    </div>

                    <!-- Pagination -->
                    <div class="flex justify-center items-center gap-2 mt-8">
                        <!-- Previous Button -->
                        <button type="button" class="w-12 h-12 flex items-center justify-center border border-gray-300 text-gray-600 hover:bg-gray-50 transition-colors rounded cursor-pointer">
                            <i class="fas fa-chevron-left"></i>
                        </button>

                        <!-- Page 1 (Active) -->
                        <button type="button" class="w-12 h-12 flex items-center justify-center border-2 border-primary bg-primary text-white font-medium transition-colors rounded cursor-pointer">
                            1
                        </button>

                        <!-- Page 2 -->
                        <button type="button" class="w-12 h-12 flex items-center justify-center border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors rounded cursor-pointer">
                            2
                        </button>

                        <!-- Page 3 -->
                        <button type="button" class="w-12 h-12 flex items-center justify-center border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors rounded cursor-pointer">
                            3
                        </button>

                        <!-- Dots -->
                        <span class="px-2 text-gray-500">...</span>

                        <!-- Last Page -->
                        <button type="button" class="w-12 h-12 flex items-center justify-center border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors rounded cursor-pointer">
                            99
                        </button>

                        <!-- Next Button -->
                        <button type="button" class="w-12 h-12 flex items-center justify-center border border-gray-300 text-gray-600 hover:bg-gray-50 transition-colors rounded cursor-pointer">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                }
                else
                {
                    <!-- No Products Found -->
                    <div class="text-center py-12">
                        <i class="fas fa-coffee text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 text-lg">No products found. Please add ProductCoffeeItem under ProductCoffee in Umbraco.</p>
                        <p class="text-gray-400 text-sm mt-2">Debug: ProductCoffee node @(Model.Children.Any(x => x.ContentType.Alias == "productCoffee") ? "found" : "not found")</p>
                    </div>
                }
            </div>
        </div>
    </div>
</section>

<script>
function toggleFilter(filterId) {
    const filterDiv = document.getElementById(filterId + '-filter');
    const icon = document.getElementById(filterId + '-icon');

    if (filterDiv.style.display === 'none') {
        filterDiv.style.display = 'block';
        icon.classList.remove('fa-chevron-down');
        icon.classList.add('fa-chevron-up');
    } else {
        filterDiv.style.display = 'none';
        icon.classList.remove('fa-chevron-up');
        icon.classList.add('fa-chevron-down');
    }
}
</script>
