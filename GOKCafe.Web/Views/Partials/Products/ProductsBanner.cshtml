@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
@{
    var sectionTitle = "NEW ARRIVALS";
    var bannerItems = new List<dynamic>();

    // Get ProductsBanner from ProductList children
    if (Model != null)
    {
        var productsBannerNode = Model.Children.FirstOrDefault(x => x.ContentType.Alias == "productsBanner");
        if (productsBannerNode != null)
        {
            // Get section title if exists
            var tempTitle = productsBannerNode.Value<string>("sectionTitle");
            if (!string.IsNullOrEmpty(tempTitle)) sectionTitle = tempTitle;

            // Get ProductsBannerItem children
            var bannerItemNodes = productsBannerNode.Children.Where(x => x.ContentType.Alias == "productsBannerItem");
            foreach (var item in bannerItemNodes)
            {
                var bannerImage = item.Value<Umbraco.Cms.Core.Models.PublishedContent.IPublishedContent>("image");
                var imageUrl = bannerImage != null ? bannerImage.Url() : "";

                bannerItems.Add(new
                {
                    Title = item.Value<string>("title") ?? item.Name,
                    Description = item.Value<string>("description") ?? "",
                    Image = imageUrl,
                    ButtonText = item.Value<string>("buttonText") ?? "Shop Now",
                    ButtonUrl = item.Value<string>("buttonUrl") ?? "#"
                });
            }
        }
    }

    // Fallback data if no Umbraco content
    if (!bannerItems.Any())
    {
        bannerItems = new List<dynamic>
        {
            new {
                Title = "Colombia Wilton Benitez Geisha",
                Description = "Discover our premium selection of specialty coffee beans, roasted to perfection.",
                Image = "/media/o1djr0so/colombiawiltonbenitezgeisha.png",
                ButtonText = "Shop Now",
                ButtonUrl = "/products"
            },
            new {
                Title = "House Blend Coffee",
                Description = "Our signature blend, carefully crafted for the perfect cup every time.",
                Image = "/media/4ingqhy4/productlist_banner_2.png",
                ButtonText = "Explore",
                ButtonUrl = "/products"
            },
            new {
                Title = "Cold Brew Collection",
                Description = "Smooth, refreshing, and ready to enjoy. Perfect for warm days.",
                Image = "/media/hmgbnfqw/productlist_banner_3.png",
                ButtonText = "Discover",
                ButtonUrl = "/products"
            }
        };
    }
}

@if (bannerItems.Any())
{
    <!-- Products Banner Carousel Section -->
    <section class="pb-8 bg-white">
        <!-- Section Title -->
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <h2 class="text-2xl md:text-3xl font-semibold text-gray-900 uppercase tracking-wide">@sectionTitle</h2>
        </div>

        <!-- Carousel Container -->
        <div class="container relative mx-auto px-4 sm:px-6 lg:px-8 ">
            <!-- Carousel Wrapper -->
            <div class="overflow-hidden w-full" id="productsBannerCarousel">
                <div class="flex transition-all duration-700 ease-in-out delay-200" id="carouselTrack">
                    @{
                        int slideIndex = 0;
                    }
                    @foreach (var item in bannerItems)
                    {
                        var isFirstSlide = (slideIndex == 0);
                        var textColor = isFirstSlide ? "text-white" : "text-[#333333]";
                        var borderColor = isFirstSlide ? "border-white" : "border-[#333333]";
                        var hoverBg = isFirstSlide ? "hover:bg-white hover:text-gray-900" : "hover:bg-[#333333] hover:text-white";
                        var justifyContent = isFirstSlide ? "justify-start" : "justify-end";

                        slideIndex++;

                        <!-- Each Slide -->
                        <div class="w-full flex-shrink-0">
                            <!-- Banner with Text Overlay -->
                            <section class="relative h-[400px] md:h-[520px] flex items-center">
                                <!-- Background Image -->
                                <div class="absolute inset-0 z-0">
                                    @if (!string.IsNullOrEmpty(item.Image))
                                    {
                                        <img src="@item.Image" alt="@item.Title" class="w-full h-full object-cover" />
                                        @if (isFirstSlide)
                                        {
                                            <div class="absolute inset-0 bg-black/30"></div>
                                        }
                                        else
                                    {
                                        <!-- Fallback background -->
                                        <div class="absolute inset-0 bg-black/20"></div>
                                    }
                                    }
                                    else
                                    {
                                        <!-- Fallback background with overlay -->
                                        <div class="absolute inset-0 bg-black opacity-80"></div>
                                    }
                                </div>

                                <!-- Content Overlay -->
                                <div class="container mx-auto px-4 sm:px-6 lg:px-12 relative z-10 flex @justifyContent">
                                    <div class="max-w-sm xl:max-w-2xl">
                                        <!-- Title -->
                                        <h3 class=" text-3xl md:text-5xl font-semibold @textColor mb-4 leading-tight">
                                            @item.Title
                                        </h3>

                                        <!-- Description -->
                                        @if (!string.IsNullOrEmpty(item.Description))
                                        {
                                            <p class="text-lg md:text-xl @textColor mb-6 leading-relaxed">
                                                @item.Description
                                            </p>
                                        }

                                        <!-- CTA Button -->
                                        <a href="@item.ButtonUrl" class="inline-block px-6 py-3 border-2 @borderColor @textColor font-medium @hoverBg transition-all duration-300">
                                            @item.ButtonText
                                        </a>
                                    </div>
                                </div>
                            </section>
                        </div>
                    }
                </div>
            </div>

            @if (bannerItems.Count > 1)
            {
                <!-- Dots Indicator -->
                <div class="flex justify-center gap-2 mt-6">
                    @for (int i = 0; i < bannerItems.Count; i++)
                    {
                        <button type="button" class="carousel-dot cursor-pointer w-4 h-4 rounded-full transition-all duration-200 @(i == 0 ? "bg-gray-800" : "border-2 border-gray-800 bg-transparent")" data-slide="@i"></button>
                    }
                </div>
            }
        </div>
    </section>

    @* Carousel JavaScript *@
    <script>
        (function() {
            const track = document.getElementById('carouselTrack');
            const dots = document.querySelectorAll('.carousel-dot');
            const prevBtn = document.getElementById('prevSlide');
            const nextBtn = document.getElementById('nextSlide');
            const totalSlides = @bannerItems.Count;
            let currentSlide = 0;
            let autoPlayInterval;

            function goToSlide(slideIndex) {
                currentSlide = slideIndex;
                track.style.transform = `translateX(-${currentSlide * 100}%)`;

                // Update dots
                dots.forEach((dot, index) => {
                    if (index === currentSlide) {
                        dot.classList.add('bg-gray-800');
                        dot.classList.remove('border-2', 'border-gray-800', 'bg-transparent');
                    } else {
                        dot.classList.remove('bg-gray-800');
                        dot.classList.add('border-2', 'border-gray-800', 'bg-transparent');
                    }
                });
            }

            function nextSlide() {
                currentSlide = (currentSlide + 1) % totalSlides;
                goToSlide(currentSlide);
            }

            function prevSlide() {
                currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
                goToSlide(currentSlide);
            }

            // Auto play
            function startAutoPlay() {
                autoPlayInterval = setInterval(nextSlide, 5000);
            }

            function stopAutoPlay() {
                clearInterval(autoPlayInterval);
            }

            // Event listeners
            if (prevBtn) {
                prevBtn.addEventListener('click', () => {
                    prevSlide();
                    stopAutoPlay();
                    startAutoPlay();
                });
            }

            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    nextSlide();
                    stopAutoPlay();
                    startAutoPlay();
                });
            }

            dots.forEach((dot, index) => {
                dot.addEventListener('click', () => {
                    goToSlide(index);
                    stopAutoPlay();
                    startAutoPlay();
                });
            });

            // Pause on hover
            const carousel = document.getElementById('productsBannerCarousel');
            carousel.addEventListener('mouseenter', stopAutoPlay);
            carousel.addEventListener('mouseleave', startAutoPlay);

            // Start auto play
            if (totalSlides > 1) {
                startAutoPlay();
            }
        })();
    </script>
}
