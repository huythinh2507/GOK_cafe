@using GOKCafe.Web.Models.ViewModels
@model ProductDetailViewModel
@{
    Layout = null;
    ViewData["Title"] = Model.Product.Name;
}

<div class="product-detail-page">
    <!-- Breadcrumb -->
    <section class="breadcrumb-section bg-light py-3">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item"><a href="/products">Products</a></li>
                    @if (Model.Category != null)
                    {
                        <li class="breadcrumb-item"><a href="/products?category=@Model.Category.Id">@Model.Category.Name</a></li>
                    }
                    <li class="breadcrumb-item active" aria-current="page">@Model.Product.Name</li>
                </ol>
            </nav>
        </div>
    </section>

    <!-- Product Detail -->
    <section class="py-5">
        <div class="container">
            <div class="row">
                <!-- Product Images -->
                <div class="col-md-6 mb-4">
                    <div class="product-images-container">
                        @if (!string.IsNullOrEmpty(Model.Product.ImageUrl))
                        {
                            <div class="main-product-image mb-3">
                                <img src="@Model.Product.ImageUrl" alt="@Model.Product.Name" class="img-fluid rounded shadow" />
                            </div>
                        }
                        else
                        {
                            <div class="main-product-image-placeholder mb-3">
                                <i class="fas fa-coffee fa-5x text-muted"></i>
                            </div>
                        }

                        @if (Model.Product.ProductImages.Any())
                        {
                            <div class="product-gallery">
                                <div class="row g-2">
                                    @foreach (var imageUrl in Model.Product.ProductImages)
                                    {
                                        <div class="col-3">
                                            <img src="@imageUrl" alt="@Model.Product.Name" class="img-fluid rounded thumbnail-image" />
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </div>

                <!-- Product Info -->
                <div class="col-md-6">
                    <div class="product-detail-info">
                        <h1 class="product-title">@Model.Product.Name</h1>

                        @if (Model.Category != null)
                        {
                            <p class="product-category mb-3">
                                <a href="/products?category=@Model.Category.Id" class="text-muted">
                                    <i class="fas fa-tag"></i> @Model.Category.Name
                                </a>
                            </p>
                        }

                        <!-- Price -->
                        <div class="product-price-section mb-4">
                            @if (Model.Product.DiscountPrice.HasValue && Model.Product.DiscountPrice > 0)
                            {
                                <div class="price-group">
                                    <span class="price-original">$@Model.Product.Price.ToString("F2")</span>
                                    <span class="price-discount">$@Model.Product.DiscountPrice.Value.ToString("F2")</span>
                                </div>
                                <div class="savings text-danger mt-2">
                                    You save $@((Model.Product.Price - Model.Product.DiscountPrice.Value).ToString("F2"))
                                    (@(Math.Round((Model.Product.Price - Model.Product.DiscountPrice.Value) / Model.Product.Price * 100))% off)
                                </div>
                            }
                            else
                            {
                                <span class="price-current">$@Model.Product.Price.ToString("F2")</span>
                            }
                        </div>

                        <!-- Description -->
                        @if (!string.IsNullOrEmpty(Model.Product.Description))
                        {
                            <div class="product-description mb-4">
                                <h5>Description</h5>
                                @Html.Raw(Model.Product.Description)
                            </div>
                        }

                        <!-- Stock Status -->
                        <div class="stock-status mb-4">
                            <h6>Availability:</h6>
                            @if (Model.Product.StockQuantity > 10)
                            {
                                <span class="badge bg-success">
                                    <i class="fas fa-check-circle"></i> In Stock (@Model.Product.StockQuantity available)
                                </span>
                            }
                            else if (Model.Product.StockQuantity > 0)
                            {
                                <span class="badge bg-warning">
                                    <i class="fas fa-exclamation-triangle"></i> Low Stock (@Model.Product.StockQuantity left)
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-danger">
                                    <i class="fas fa-times-circle"></i> Out of Stock
                                </span>
                            }
                        </div>

                        <!-- Product Badges -->
                        <div class="product-badges mb-4">
                            @if (Model.Product.IsFeatured)
                            {
                                <span class="badge bg-warning text-dark me-2">
                                    <i class="fas fa-star"></i> Featured Product
                                </span>
                            }
                        </div>

                        <!-- Add to Cart -->
                        <div class="product-actions">
                            @if (Model.Product.StockQuantity > 0)
                            {
                                <div class="d-grid gap-2 mb-3">
                                    <button class="btn btn-primary btn-lg" onclick="addToCart('@Model.Product.Id')">
                                        <i class="fas fa-shopping-cart"></i> Add to Cart
                                    </button>
                                    <button class="btn btn-outline-secondary">
                                        <i class="fas fa-heart"></i> Add to Wishlist
                                    </button>
                                </div>
                            }
                            else
                            {
                                <div class="alert alert-warning">
                                    This product is currently out of stock.
                                </div>
                            }
                        </div>

                        <!-- Product Meta -->
                        <div class="product-meta mt-4 pt-4 border-top">
                            <p class="mb-2"><strong>SKU:</strong> @Model.Product.Slug</p>
                            @if (Model.Category != null)
                            {
                                <p class="mb-2"><strong>Category:</strong> @Model.Category.Name</p>
                            }
                            <p class="mb-2"><strong>Share:</strong>
                                <a href="#" class="ms-2"><i class="fab fa-facebook"></i></a>
                                <a href="#" class="ms-2"><i class="fab fa-twitter"></i></a>
                                <a href="#" class="ms-2"><i class="fab fa-pinterest"></i></a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Related Products -->
    @if (Model.RelatedProducts.Any())
    {
        <section class="related-products py-5 bg-light">
            <div class="container">
                <h3 class="mb-4">You May Also Like</h3>
                <div class="row">
                    @foreach (var product in Model.RelatedProducts)
                    {
                        <div class="col-md-3 mb-4">
                            <div class="product-card">
                                <div class="product-image-wrapper">
                                    @if (!string.IsNullOrEmpty(product.ImageUrl))
                                    {
                                        <img src="@product.ImageUrl" alt="@product.Name" class="product-image" />
                                    }
                                    else
                                    {
                                        <div class="product-image-placeholder">
                                            <i class="fas fa-coffee fa-2x"></i>
                                        </div>
                                    }
                                </div>
                                <div class="product-info">
                                    <h5 class="product-name">
                                        <a href="/products/@product.Slug">@product.Name</a>
                                    </h5>
                                    <div class="product-price">
                                        @if (product.DiscountPrice.HasValue && product.DiscountPrice > 0)
                                        {
                                            <span class="price-original">$@product.Price.ToString("F2")</span>
                                            <span class="price-discount">$@product.DiscountPrice.Value.ToString("F2")</span>
                                        }
                                        else
                                        {
                                            <span class="price">$@product.Price.ToString("F2")</span>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </section>
    }
</div>

@section Scripts {
    <script>
        function addToCart(productId) {
            console.log('Add to cart:', productId);
            alert('Product added to cart!');

            const cartCount = document.querySelector('.cart-count');
            if (cartCount) {
                const currentCount = parseInt(cartCount.textContent) || 0;
                cartCount.textContent = currentCount + 1;
            }
        }

        // Thumbnail click handler
        document.querySelectorAll('.thumbnail-image').forEach(img => {
            img.addEventListener('click', function() {
                const mainImage = document.querySelector('.main-product-image img');
                if (mainImage) {
                    mainImage.src = this.src;
                }
            });
        });
    </script>
}